<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>ÁΩóÂ∞èÈªë LED ÁÇπÈòµ</title>
    <link rel="stylesheet" href="js/styles.css">
    <style>
        .ui-buttons {
            position: fixed;
            bottom: 3vh;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 2vw;
            z-index: 9;
            pointer-events: auto;
        }

        .ui-buttons button {
            background-color: rgba(0, 0, 0, 0.5);
            color: #00FFFF;
            border: none;
            padding: 1vh 2vh;
            font-size: 1.5vh;
            border-radius: 0.5vh;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .ui-buttons button:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
        }


        .iframe-cat {
            position: absolute;
            justify-content: center;
            align-items: center;
            top: 0vh;
            left: 34%;
            width: 50vh;
            height: 50vh;
            z-index: 9;
            border: none;
            background: transparent;
            overflow: hidden;
            transition: top 0.5s ease, left 0.5s ease, transform 0.3s ease;
        }

        .iframe-infinite {
            position: absolute;
            justify-content: center;
            align-items: center;
            top: -5vh;
            left: 50%;
            width: 55vh;
            height: 55vh;
            z-index: 9;
            border: none;
            background: transparent;
            overflow: hidden;
            transition: top 0.5s ease, left 0.5s ease, transform 0.3s ease;
        }

        #hourtext {
            display: none;
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6vh;
            color: #00FFFF;
            z-index: 9999;
            text-shadow: 0 0 10px #000;
        }

        #iframeContainer {
            position: absolute;
            width: 1600px;
            height: 800px;
            transform-origin: top left;
            z-index: 88;
        }

        #iframeIN {
            width: 100%;
            height: 100%;
            border: none;
            transition: opacity 0.3s ease, transform 0.6s ease;

        }
    </style>
</head>

<body>
    <div class="iframe-cat" id="iframeCat">
        <iframe src="cat.html"></iframe>
    </div>
    <div id="iframeContainer">
        <iframe id="iframeIN" src="wuxianhead.html" frameborder="0"></iframe>
    </div>
    <div class="matrix-row" id="matrixContainer"></div>
    <!-- Âú® matrixContainer ‰∏ãÈù¢Ê∑ªÂä† -->
    <div id="hourTextDisplay"> </div>
    <div class="containInput">
        <div class="palette">
            <span class="color-swatch" data-color="#93df08" style="background:#93df08;"></span>
            <span class="color-swatch" data-color="#FFA500" style="background:#FFA500;"></span>
            <span class="color-swatch" data-color="#FFFF00" style="background:#FFFF00;"></span>
            <span class="color-swatch" data-color="#00CC66" style="background:#00CC66;"></span>
            <span class="color-swatch" data-color="#00BFFF" style="background:#00BFFF;"></span>
            <span class="color-swatch" data-color="#00FFFF" style="background:#00FFFF;"></span>
            <span class="color-swatch" data-color="#8A2BE2" style="background:#8A2BE2;"></span>
            <span class="color-swatch" data-color="#FF69B4" style="background:#FF69B4;"></span>
            <span class="color-swatch" data-color="#FFFFFF" style="background:#FFFFFF;"></span>
            <span class="color-swatch" data-color="#FF8C00" style="background:#FF8C00;"></span>
            <span id="flickerToggle" class="color-swatch" style="background:#000000;" title="Èó™ÁÉÅÂºÄÂÖ≥"></span>
            <button class="symbol-btn">‚ö†Ô∏è</button>
            <button class="symbol-btn">‚ò¢Ô∏è</button>
            <button class="symbol-btn">‚ò£Ô∏è</button>
        </div>
        <div id="countdownDisplay" style="color:#00FFFF; font-size:1.5vh;">‰∏ã‰∏ÄÂè•ÂÄíËÆ°Êó∂Ôºö--</div>

        <div class="ui-buttons">
            <div class="left-buttons">
                <button id="about-button">aj300542</button>
            </div>
            <div class="right-buttons">
                <button id="autoDemoBtn">Ëá™Âä®ÊºîÁ§∫</button>
                <button id="interruptDemoBtn">‰∏≠Êñ≠ÊºîÁ§∫</button>
            </div>
        </div>


        <div class="input-area">
            <input type="text" id="textInput" placeholder="ËØ∑ËæìÂÖ•ÊñáÂ≠ó">
            <button onclick="enterFullscreen()">ÂÖ®Â±èÊòæÁ§∫</button>
        </div>
    </div>
    <script>
        window.addEventListener("message", (event) => {
            if (event.data.type === "labubuPosition") {
                const container = document.getElementById("iframeContainer");

                const rect = container.getBoundingClientRect();
                const padding = 20;

                const maxX = window.innerWidth - rect.width - padding;
                const maxY = window.innerHeight - rect.height - padding;

                const x = Math.min(Math.max(event.data.x - rect.width / 2, padding), maxX);
                const y = Math.min(Math.max(event.data.y - rect.height / 2, padding), maxY);

                container.style.left = `${x}px`;
                container.style.top = `${y}px`;
                container.style.transform = `translate(0px, 0px)`; // Ê∏ÖÈô§ transform
            }
        });
    </script>

    <script>
        let jumpInterval;

        function jumpWithPause() {
            const iframeCat = document.getElementById("iframeCat");

            const maxX = window.innerWidth - iframeCat.offsetWidth;
            const maxY = window.innerHeight - iframeCat.offsetHeight;

            const randomX = Math.floor(Math.random() * maxX);
            const randomY = Math.floor(Math.random() * maxY);

            iframeCat.style.left = randomX + "px";
            iframeCat.style.top = randomY + "px";
            iframeCat.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;

            const delay = Math.floor(Math.random() * 5000) + 1000; // 1~6Áßí‰πãÈó¥

            jumpInterval = setTimeout(jumpWithPause, delay);
        }

        // ÁªëÂÆöÂêØÂä®ÊåâÈíÆ
        document.getElementById("autoDemoBtn").addEventListener("click", () => {
            if (!jumpInterval) jumpWithPause();
        });

        // üßπ ÁªëÂÆö‚Äú‰∏≠Êñ≠ÊºîÁ§∫‚ÄùÊåâÈíÆÊù•ÂÅúÊ≠¢Ë∑≥Ë∑É
        document.getElementById("interruptDemoBtn").addEventListener("click", () => {
            clearTimeout(jumpInterval);
            jumpInterval = null;

            const iframeCat = document.getElementById("iframeCat");
            iframeCat.style.left = "50%";
            iframeCat.style.top = "25%";
            iframeCat.style.transform = "rotate(0deg) translate(-50%, -50%)";
        });


    </script>
    <script>
        window.cols = 16;
        window.rows = 22;
        window.ledColor = "#00FFFF";
        window.flickerSpeed = 0.25;

        let clockMode = true;
        let clockInterval = null;
        let flickerEnabled = true;

        function updateClockText() {
            const now = new Date();
            const hh = String(now.getHours()).padStart(2, "0");
            const mm = String(now.getMinutes()).padStart(2, "0");
            const ss = String(now.getSeconds()).padStart(2, "0");
            const timeStr = hh + mm + ss;

            const input = document.getElementById("textInput");
            input.value = timeStr;
            window.MatrixRenderer.updateTexts(timeStr.split(""));
        }

        window.onload = () => {
            updateClockText();
            window.MatrixRenderer.init(document.getElementById("matrixContainer"));
            clockInterval = setInterval(() => {
                if (clockMode) updateClockText();
            }, 1000);

            document.querySelectorAll(".color-swatch").forEach(swatch => {
                swatch.classList.remove("selected");
                if (swatch.dataset.color === window.ledColor) {
                    swatch.classList.add("selected");
                }
            });

            const flickerToggle = document.getElementById("flickerToggle");
            flickerToggle.classList.add("active");
            flickerToggle.addEventListener("click", () => {
                flickerEnabled = !flickerEnabled;
                window.flickerSpeed = flickerEnabled ? 0.15 : 0;
                flickerToggle.classList.toggle("active", flickerEnabled);

                // ‚úÖ ÊÅ¢Â§çÈªòËÆ§È¢úËâ≤
                window.ledColor = "#00FFFF";
                window.MatrixRenderer.updateColor(window.ledColor);

                // ‚úÖ Âº∫Âà∂Âà∑Êñ∞Â≠óÁ¨¶Ê∏≤Êüì
                const currentText = document.getElementById("textInput").value;
                window.MatrixRenderer.updateTexts(currentText.split(""));

                // ‚úÖ Êõ¥Êñ∞Ë∞ÉËâ≤ÊùøÈÄâ‰∏≠Áä∂ÊÄÅ
                document.querySelectorAll(".color-swatch").forEach(s => s.classList.remove("selected"));
                document.querySelectorAll(".color-swatch").forEach(s => {
                    if (s.dataset.color === "#00FFFF") {
                        s.classList.add("selected");
                    }
                });
            });

        };

        document.getElementById("textInput").addEventListener("input", (e) => {
            clockMode = false;
            clearInterval(clockInterval);
            window.MatrixRenderer.updateTexts(e.target.value.split(""));
        });

        document.querySelectorAll(".color-swatch").forEach(swatch => {
            swatch.addEventListener("click", () => {
                window.ledColor = swatch.dataset.color;
                window.MatrixRenderer.updateColor(window.ledColor);

                document.querySelectorAll(".color-swatch").forEach(s => s.classList.remove("selected"));
                swatch.classList.add("selected");

                // ‚úÖ Âº∫Âà∂Âà∑Êñ∞Â≠óÁ¨¶Ê∏≤ÊüìÔºåÁ°Æ‰øùÈ¢úËâ≤Êõ¥Êñ∞Á´ãÂç≥ÁîüÊïà
                const currentText = document.getElementById("textInput").value;
                window.MatrixRenderer.updateTexts(currentText.split(""));
            });
        });

        function enterFullscreen() {
            const container = document.querySelector(".containInput");
            container.style.display = "none";
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            }
        }

        document.addEventListener("fullscreenchange", () => {
            const container = document.querySelector(".containInput");
            if (!document.fullscreenElement) {
                container.style.display = "flex";
            }
        });
        document.getElementById("about-button").addEventListener("click", () => {
            window.open("https://aj300542.github.io/", "_blank");
        });
    </script>
    <script src="js/demoController.js"></script>
    <script>
        // üëá ‰Ω†ÁöÑÂàùÂßãÂåñÈÄªËæëÊîæËøôÈáå
        window.addEventListener("load", () => {
            fetchTxtFile("js/texts.txt");
            //setTimeout(startAutoLoop, 5000);

            updateClockText();
            if (window.MatrixRenderer && typeof window.MatrixRenderer.init === "function") {
                window.MatrixRenderer.init(document.getElementById("matrixContainer"));
            } else {
                console.error("MatrixRenderer Êú™ÂÆö‰πâÊàñÊú™Ê≠£Á°ÆÂä†ËΩΩ");
            }

            clockInterval = setInterval(() => {
                if (clockMode) updateClockText();
            }, 1000);

            // ÂÖ∂ÂÆÉÂàùÂßãÂåñÈÄªËæëÊê¨Âà∞ËøôÈáå
        });
    </script>
    <script>
        function updateClockText() {
            const now = new Date();
            const hh = String(now.getHours()).padStart(2, "0");
            const mm = String(now.getMinutes()).padStart(2, "0");
            const ss = String(now.getSeconds()).padStart(2, "0");
            const timeStr = hh + mm + ss;

            const input = document.getElementById("textInput");

            // Êï¥ÁÇπËß¶ÂèëËá™Âä®ÊºîÁ§∫
            if (mm === "00" && ss === "00") {
                clockMode = false;
                clearInterval(clockInterval);

                // ÊòæÁ§∫‚ÄúXÁÇπÊï¥‚ÄùÂà∞Êñ∞ÂÖÉÁ¥†
                const hourText = parseInt(hh, 10) + "ÁÇπÊï¥";
                const hourTextDiv = document.getElementById("hourTextDisplay");
                hourTextDiv.textContent = hourText;
                hourTextDiv.style.display = "block";

                document.getElementById("autoDemoBtn").click();

                // 5ÁßíÂêéÊÅ¢Â§çÊó∂ÈíüÂπ∂ÈöêËóè
                setTimeout(() => {
                    hourTextDiv.style.display = "none";
                    clockMode = true;
                    updateClockText();
                    clockInterval = setInterval(() => {
                        if (clockMode) updateClockText();
                    }, 1000);
                    document.getElementById("interruptDemoBtn").click();
                }, 5000);
            } else {
                // Ê≠£Â∏∏Êó∂Èíü
                input.value = timeStr;
                window.MatrixRenderer.updateTexts(timeStr.split(""));
            }
        }
    </script>
    <script src="js/txt.js"></script>
</body>

</html>